KillerFile
=========

While creating webapps, the number of js and css files grows like mushrooms in a moist basement. And we all know, the more JS and CSS files you have, the slower your page will load. 

Hence I created: KillerFile, it's a file killer, combines and minifies:

* Javasccript
* Stylesheets

It only minifies when `Kohana::$environment >= KOHANA::TESTING`, otherwise it will pass the files one by one in a html-tag.

Functions
-------------

* add multiple files, and get them combined in a single minified file
* send this single file in gzip
* set http_headers `content-type`, `cache-control`, `expires`, and `last-modified`

How-to
----------------------

Create a instance, the first param is the type (css or js), the second param (mandatory) is to create a group of files.

	$killerjs = KillerJS::instance('css','screen')

Add files, can be a string containing one file, or an array with many files. A file can be a absolute path, a relative path from `APPPATH` or `MODPATH`, a url to external site, or local site.
If the file is a lesscss file, it is compiled and minified.

	$killerjs->add_files(array(
			'/css/screen.css',
			'/css/style.less',
			'/css/datePicker.css',
			'/css/jquery.tooltip.css',
		));
  
Now it's time to get the html tag. Most times you'll have two sets of stylesheet, one for `media=screen` and another `media=print`. So we set this as the param

	echo $killerjs->get_tag(array('media' => 'screen'));
	
Here is a real-life example, where we reduce the http requests from more-than-I-can-count-on-two-hands  down to something-I-can-count-easy-on-one-hand-and-have-fingers-left-over:

	$media = Route::get('admin/media');
    
    echo KillerJS::instance('css','screen')->add_files(array(
	    	$media->uri(array('file' => '/css/screen.css')),
	    	$media->uri(array('file' => '/css/style.css')),
	    	$media->uri(array('file' => '/css/datePicker.css')),
	    	$media->uri(array('file' => '/css/jquery.tooltip.css')),
    	))->get_tag(array('media' => 'screen'));
    	
    echo KillerJS::instance('css','print')->add_files(array(
	    	$media->uri(array('file' => '/css/print.css')),
    	))->get_tag(array('media' => 'print'));

     
    echo KillerJS::instance('js')->add_files(array(
	    	'https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js',
	    	$media->uri(array('file' => '/js/jquery.validate.min.js')),
	    	$media->uri(array('file' => '/js/jquery.confirm-1.3.js')),
	    	$media->uri(array('file' => '/js/jquery.tooltip.min.js')),
	    	$media->uri(array('file' => '/js/localization/messages_nl.js')),
	    	$media->uri(array('file' => '/js/localization/methods_nl.js')),
	    	$media->uri(array('file' => '/js/date.js',)),
	    	$media->uri(array('file' => '/js/jquery.datePicker.js')),
	    	$media->uri(array('file' => '/js/jquery.tooltip.min.js')),
	    	$media->uri(array('file' => '/js/functions.js')),  	
    	))->get_tag();
    	
    echo KillerJS::instance('js','page_specific')
    	->add_files($scripts)
    	->get_tag();
    	
    	
Which results in something like:

	<link type="text/css" href="http://localhost/mini/1ac283.css" rel="stylesheet" media="screen" />
	<link type="text/css" href="http://localhost/mini/a6de54.css" rel="stylesheet" media="print" />
	<script type="text/javascript" src="http://localhost/mini/e6bbd2.js"></script>
	<script type="text/javascript" src="http://localhost/mini/dd21c3.js"></script>


Behind the scene
------------

This is how it works;

1. a md5 hash is generated based on the added files
2. if the cache is empty, the content of each file is collected and minifed
3. all the content is written in the cache with the md5-hash
4. a html tag is generated, with a uri generated by route: `Route::get('admin/mini')->uri(array('file' => md5-hash)`
5. the controller `admin/media` has a action `minify`, this reads the cache and outputs it
6. a user is happy with the loading speed of the pages

Thanks to
----------------
This Helper is helped by:

* [cssmin](http://code.google.com/p/cssmin/), the css minifier
* [jsmin](https://github.com/rgrove/jsmin-php/), the js minifier
